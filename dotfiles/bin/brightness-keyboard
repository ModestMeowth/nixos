#!/usr/bin/env bash

direction="${1:-up}"

device=""
for candidate in /sys/class/leds/*kbd_backlight*; do
    if [[ -e "$candidate" ]]; then
        device="$(basename "$candidate")"
        break
    fi
done

if [[ -z "$device" ]]; then
    echo "No keyboard backlight device found" >&2
    exit 1
fi

max_brightness="$(brightnessctl -d "$device" max)"
current_brightness="$(brightnessctl -d "$device" get)"

if [[ "$direction" == "up" ]]; then
    new_brightness=$((current_brightness + 1))
    [[ $new_brightness -gt $max_brightness ]] && new_brightness=$max_brightness
else
    new_brightness=$((current_brightness -1))
    [[ $new_brightness -lt 0 ]] && new_brightness=0
fi

brightnessctl -d "$device" set "$new_brightness" >/dev/null

percent=$((new_brightness * 100 / max_brightness))
swayosd-brightness "$percent"

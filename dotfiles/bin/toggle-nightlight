#!/usr/bin/env bash

ON_TEMP=3000
OFF_TEMP=5000

if ! pgrep -x hyprsunset; then
    setsid uwsm app -- hyprsunset &
    sleep 1
fi

CURRENT_TEMP=$(hyprctl hyprsunset temperature 2>/dev/null | grep -oE '[0-9]+')

restart_nightlighted_waybar() {
    if grep -q "custom/nightlight" ~/.config/waybar/config.jsonc; then
        restart-waybar
    fi
}

if [[ "$CURRENT_TEMP" == "$OFF_TEMP" ]]; then
    hyprctl hyprsunset temperature $ON_TEMP
    notify-send "  Nightlight screen temperature"
    restart_nightlighted_waybar
else
    hyprctl hyprsunset temperature $OFF_TEMP
    notify-send "   Daylight screen temperature"
    restart_nightlighted_waybar
fi
